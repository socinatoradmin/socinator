<UserControl
    x:Class="PinDominator.CustomControl.AccountDetailsSelector"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:DominatorHouseCore.Converters;assembly=DominatorHouseCore"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:pdModel="clr-namespace:PinDominatorCore.PDModel;assembly=PinDominatorCore"
    x:Name="AccountDetailsSelectors"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:ListViewItemIndexConverter x:Key="ListViewItemIndexConverter" />
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:BooleanToStringSelectConverter x:Key="BooleanToStringSelectConverter" />
        <converters:StringEqualToVisibilityConverter x:Key="VisibleIfEqual" Expected="180" />
    </UserControl.Resources>
    <Border
        Margin="10"
        BorderBrush="{DynamicResource AccentBaseColorBrush}"
        BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="0.8*" />
                <RowDefinition Height="10*" />
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Background="{DynamicResource AccentBaseColorBrush}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  Filter Section  -->

                <StackPanel Orientation="Horizontal">
                    <mah:ProgressRing
                        Width="30"
                        Height="30"
                        HorizontalAlignment="Left"
                        Foreground="White"
                        IsActive="{Binding IsProgressRingActive}"
                        Visibility="{Binding IsProgressRingActive, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="13"
                        FontWeight="SemiBold"
                        Foreground="White"
                        Text="{Binding StatusText}" />
                </StackPanel>


                <TextBox
                    Name="TextSearch"
                    Grid.Column="1"
                    Width="250"
                    Height="28"
                    Margin="5"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    mah:TextBoxHelper.ButtonCommand="{Binding TextSearchCommand, Mode=OneWay}"
                    mah:TextBoxHelper.Watermark="{DynamicResource LangKeySearch}"
                    Style="{StaticResource SearchMetroTextBox}"
                    Text="{Binding TextSearch, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

            </Grid>


            <!--  Account detail list  -->
            <Grid Grid.Row="1" Margin="0,10,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="10*" />
                    <RowDefinition Height="0.8*" />
                </Grid.RowDefinitions>


                <ListView
                    Name="LstBoards"
                    Grid.Row="0"
                    mah:ScrollViewerHelper.IsHorizontalScrollWheelEnabled="False"
                    ItemContainerStyle="{StaticResource ListViewItems}"
                    ItemsSource="{Binding AccountDetailsSelectorView}">
                    <ListView.Resources>
                        <Style BasedOn="{StaticResource {x:Type GridViewColumnHeader}}" TargetType="{x:Type GridViewColumnHeader}">
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                        </Style>
                    </ListView.Resources>
                    <ListView.View>
                        <GridView AllowsColumnReorder="False">
                            <GridViewColumn Width="100">
                                <GridViewColumn.Header>
                                    <Border Margin="-6,-2,-6,-2" BorderBrush="LightGray">
                                        <CheckBox
                                            x:Name="AllAccount"
                                            Command="{Binding SelectSection}"
                                            CommandParameter="{Binding IsAllCampaignSelected, Converter={StaticResource BooleanToStringSelectConverter}}"
                                            Content=" #"
                                            IsChecked="{Binding IsAllCampaignSelected}" />
                                    </Border>
                                </GridViewColumn.Header>
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate DataType="{x:Type pdModel:AccountDetailsSelectorModel}">
                                        <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                            <CheckBox
                                                x:Name="SingleAccount"
                                                Margin="5,0,0,0"
                                                Command="{Binding DataContext.SelectSection, RelativeSource={RelativeSource AncestorType={x:Type ListView}}}"
                                                CommandParameter="Manually"
                                                IsChecked="{Binding IsSelected}" />
                                            <Label Content="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListViewItem}}, Converter={StaticResource ListViewItemIndexConverter}}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>

                            <GridViewColumn DisplayMemberBinding="{Binding DetailName}" Header="{Binding DetailsNameHeader}" />
                            <GridViewColumn DisplayMemberBinding="{Binding DetailUrl}" Header="{Binding DetailsUrlHeader}" />

                            <GridViewColumn x:Name="QueryHeader" Width="180">
                                <GridViewColumnHeader Content="{Binding DetailsQueryTypeHeader}" Visibility="{Binding ElementName=QueryHeader, Path=Width, Converter={StaticResource VisibleIfEqual}}" />
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate DataType="{x:Type pdModel:AccountDetailsSelectorModel}">
                                        <ComboBox ItemsSource="{Binding QueryType}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <CheckBox
                                                        x:Name="chkQuery"
                                                        Checked="chkQuery_Checked"
                                                        IsChecked="{Binding IsContentSelected}"
                                                        Unchecked="chkQuery_Unchecked">
                                                        <TextBlock Text="{Binding Content}" />
                                                    </CheckBox>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn x:Name="LabelHeader" Width="180">
                                <GridViewColumnHeader Content="{Binding DetailsLabelHeader}" Visibility="{Binding ElementName=LabelHeader, Path=Width, Converter={StaticResource VisibleIfEqual}}" />
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate DataType="{x:Type pdModel:AccountDetailsSelectorModel}">
                                        <TextBox Text="{Binding Label, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" />
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn x:Name="SectionHeader" Header="{Binding DetailsUrlSection}">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border MinWidth="150" Margin="-6,-2,-6,-2">
                                            <Button
                                                x:Name="ButtonSelectSection"
                                                Margin="6,2,6,2"
                                                Background="Transparent"
                                                Command="{Binding Path=DataContext.SelectSectionCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"
                                                Content="{Binding DetailSection, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Cursor="Hand"
                                                FontWeight="SemiBold">
                                                <Button.Style>
                                                    <Style BasedOn="{StaticResource {x:Type Button}}" TargetType="{x:Type Button}">
                                                        <Setter Property="IsEnabled" Value="false" />
                                                        <Setter Property="Foreground" Value="{DynamicResource AccentBaseColorBrush}" />
                                                        <Style.Triggers>
                                                            <MultiDataTrigger>
                                                                <MultiDataTrigger.Conditions>
                                                                    <Condition Binding="{Binding IsSelected}" Value="true" />
                                                                    <Condition Binding="{Binding IsSectionAvailable}" Value="true" />
                                                                </MultiDataTrigger.Conditions>
                                                                <Setter Property="IsEnabled" Value="True" />
                                                            </MultiDataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>

                <StackPanel
                    Grid.Row="1"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <Button
                        Name="BtnSave"
                        Height="30"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Center"
                        x:FieldModifier="public"
                        Background="{DynamicResource AccentBaseColorBrush}"
                        Content="{DynamicResource LangKeySave}"
                        Foreground="White" />
                    <Button
                        Name="BtnCancel"
                        Height="30"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Center"
                        x:FieldModifier="public"
                        Background="{DynamicResource AccentBaseColorBrush}"
                        Content="{DynamicResource LangKeyCancel}"
                        Foreground="White" />
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>